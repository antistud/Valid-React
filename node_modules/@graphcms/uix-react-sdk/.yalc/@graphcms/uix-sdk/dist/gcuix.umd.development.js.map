{"version":3,"file":"gcuix.umd.development.js","sources":["../src/base.ts","../src/type-helpers/toast.ts","../src/type-helpers/user.ts","../src/field.ts","../src/index.ts"],"sourcesContent":["import type { ShowToast, OpenDialog } from './type-helpers';\nimport type { ExtensionDeclaration } from '.';\nimport type { FieldExtensionDeclaration } from './field';\nimport type { openAssetPicker as OpenAssetPicker } from './type-helpers/openAssetPicker';\n\n// see https://github.com/krakenjs/zoid/blob/master/src/component/props.js#L53\nexport const reservedExtensionProps = [\n  'timeout',\n  'window',\n  'close',\n  'focus',\n  'resize',\n  'uid',\n  'cspNonce',\n  'getParent',\n  'getParentDomain',\n  'hide',\n  'show',\n  'export',\n  'onDisplay',\n  'onRendered',\n  'onRender',\n  'onClose',\n  'onDestroy',\n  'onResize',\n  'onFocus',\n  'onError',\n  'onProps',\n];\n\nexport const ExtensionPermission = {\n  INPUT: 'INPUT',\n  FORM: 'FORM',\n  API: 'API',\n} as const;\n\nexport const ExtensionType = {\n  formSidebar: 'formSidebar',\n  field: 'field',\n} as const;\n\nexport const ConfigType = {\n  string: 'string',\n  number: 'number',\n  boolean: 'boolean',\n} as const;\n\nexport interface IExtensionDeclaration {\n  name: string;\n  description?: string;\n  permissions?: (keyof typeof ExtensionPermission)[];\n  config?: Record<ConfigVariableName, ConfigVariableSettings>;\n}\n\nexport type ConfigVariableName = string;\n\nexport type ConfigVariableSettings = {\n  type: keyof typeof ConfigType;\n  displayName?: string;\n  description?: string;\n  required?: boolean;\n  defaultValue?: any;\n};\n\nexport type ConfigFields = Record<ConfigVariableName, ConfigVariableSettings>;\n\nexport type ConfigValue =\n  | Record<string, boolean | number | string | undefined | null>\n  | undefined;\n\nexport type Project = {\n  id: string;\n  name: string;\n  mgmtApi: string;\n  mgmtToken: string;\n};\n\nexport type Environment = {\n  id: string;\n  name: string;\n  endpoint: string;\n  authToken: string;\n};\n\nexport type Context = {\n  project: Project;\n  environment: Environment;\n};\n\nexport interface ExtensionPropsBase {\n  context: Context;\n  openDialog: OpenDialog;\n  showToast: ShowToast;\n  openAssetPicker: OpenAssetPicker;\n  redirectParent: (location: string | Location) => Promise<void>;\n  historyReplace: (url: string | HistoryCallback) => Promise<void>;\n  historyPush: (url: string | HistoryCallback) => Promise<void>;\n}\n\nexport interface ExtensionDialogProps extends ExtensionPropsBase {\n  onCloseDialog: (value: any) => void;\n}\n\ntype HistoryCallback = (href: Location['href']) => string;\n","type Id = number | string;\n\nexport const ToastVariantColor = {\n  success: 'success',\n  error: 'error',\n  warning: 'warning',\n  info: 'info',\n  primary: 'primary',\n  dark: 'dark',\n  publish: 'publish',\n} as const;\n\nexport const ToastPosition = {\n  'top-right': 'top-right',\n  'top-center': 'top-center',\n  'top-left': 'top-left',\n  'bottom-right': 'bottom-right',\n  'bottom-center': 'bottom-center',\n  'bottom-left': 'bottom-left',\n} as const;\n\nexport type ToastOptions = {\n  title: string;\n  description?: string;\n  variantColor: keyof typeof ToastVariantColor;\n  id?: Id;\n  isClosable?: boolean;\n  position?: keyof typeof ToastPosition;\n  duration?: number;\n};\n\nexport type ShowToast = (options: ToastOptions) => Promise<Id>;\n","export const UserKind = {\n  MEMBER: 'MEMBER',\n  PAT: 'PAT',\n  PUBLIC: 'PUBLIC',\n  WEBHOOK: 'WEBHOOK',\n} as const;\n\nexport type User = {\n  id: string;\n  kind: keyof typeof UserKind;\n  name: string;\n  picture: string | null;\n  isActive: boolean;\n};\n","import type { Form, Model, SetFieldsVisibility } from './type-helpers';\nimport type {\n  IExtensionDeclaration,\n  ConfigFields,\n  ExtensionPropsBase,\n  ConfigValue,\n  ExtensionType,\n} from './base';\nimport type {\n  FocusEvent as ReactFocusEvent,\n  ChangeEvent as ReactChangeEvent,\n} from 'react';\nimport type { Field } from './type-helpers/field';\n\nexport const FieldExtensionType = {\n  STRING: 'STRING',\n  RICHTEXT: 'RICHTEXT',\n  INT: 'INT',\n  FLOAT: 'FLOAT',\n  BOOLEAN: 'BOOLEAN',\n  JSON: 'JSON',\n  DATETIME: 'DATETIME',\n  DATE: 'DATE',\n  LOCATION: 'LOCATION',\n  COLOR: 'COLOR',\n  ENUMERATION: 'ENUMERATION',\n  RELATION: 'RELATION',\n  ASSET: 'ASSET',\n  UNION: 'UNION',\n} as const;\n\nexport const FieldExtensionFeature = {\n  FieldRenderer: 'FieldRenderer',\n  ListRenderer: 'ListRenderer',\n  TableRenderer: 'TableRenderer',\n} as const;\n\nexport interface FieldExtensionDeclaration extends IExtensionDeclaration {\n  extensionType: typeof ExtensionType.field;\n  fieldType: keyof typeof FieldExtensionType;\n  /**\n   * Extension capabilities\n   */\n  features: (keyof typeof FieldExtensionFeature)[];\n  fieldConfig?: ConfigFields;\n  listConfig?: ConfigFields;\n  tableConfig?: ConfigFields;\n}\n\nexport interface FieldExtensionProps extends ExtensionPropsBase {\n  extension: {\n    config: ConfigValue;\n    tableConfig: ConfigValue;\n    fieldConfig: ConfigValue;\n    id: string;\n  };\n\n  isExpanded: boolean;\n  expand: (expand: boolean | ((isExpanded: boolean) => boolean)) => unknown;\n\n  // name of the field in the form (may differ from the field apiId, ie. for localized fields)\n  name: string;\n\n  // current locale on localized field\n  locale: string;\n\n  // current entry id, null for new entries;\n  entryId: string | null;\n\n  isTableCell: boolean;\n\n  isReadOnly: boolean | undefined;\n\n  value: any;\n\n  onBlur: <T extends FocusEvent | ReactFocusEvent>(event?: T) => Promise<void>;\n\n  onChange: <T extends InputEvent | ReactChangeEvent>(\n    event: T | any\n  ) => Promise<void>;\n\n  onFocus: <T extends FocusEvent | ReactFocusEvent>(event?: T) => Promise<void>;\n\n  // @see https://final-form.org/docs/react-final-form/types/FieldRenderProps\n  meta: {\n    active: boolean;\n    error: any;\n    touched: boolean;\n  };\n\n  /**\n   * @deprecated use `expand` instead\n   */\n  expandField: (expand: boolean) => unknown;\n\n  form: Form;\n  field: Field;\n  model: Model;\n  /**\n   * @deprecated Please use {@link Form.setFieldsVisibility}\n   */\n  setFieldsVisibility: SetFieldsVisibility;\n  /**\n   * @deprecated Please use {@link ExtensionPropsBase.extension extension.fieldConfig}\n   */\n  fieldConfig: ConfigValue;\n  /**\n   * @deprecated Please use {@link ExtensionPropsBase.extension extension.tableConfig}\n   */\n  tableConfig: ConfigValue;\n}\n","import zoid from '@graphcms/zoid/lib/zoid.js';\n\nimport { ExtensionDialogProps, reservedExtensionProps } from './base';\nimport type { FieldExtensionDeclaration, FieldExtensionProps } from './field';\nimport type {\n  FormSidebarExtensionDeclaration,\n  FormSidebarExtensionProps,\n} from './formSidebar';\n\nexport * from './base';\nexport * from './formSidebar';\nexport * from './type-helpers';\nexport * from './field';\n\nexport type ExtensionProps =\n  | FieldExtensionProps\n  | FormSidebarExtensionProps\n  | ExtensionDialogProps;\n\ntype Xprops = {\n  onProps: (props: Record<string, any>) => void;\n  onConnected: (\n    uid: string,\n    declaration: ExtensionDeclaration\n  ) => Promise<unknown>;\n  resize: (size: {\n    height: 'auto' | 'full' | number;\n    width: 'auto' | '100%' | number;\n  }) => unknown;\n} & ExtensionProps;\n\ndeclare global {\n  interface Window {\n    xprops: Xprops;\n  }\n}\n\nexport type ExtensionDeclaration =\n  | FieldExtensionDeclaration\n  | FormSidebarExtensionDeclaration;\n\nfunction handleProps(props: any) {\n  const transformedProps: any = {};\n  Object.keys(props).forEach((key: string) => {\n    // do not pass down zoid props to the extension\n    if (reservedExtensionProps.includes(key)) return;\n\n    // transform props that were prefixed with '_' to bypass zoid reverved porps\n    if (\n      key.startsWith('_') &&\n      reservedExtensionProps.includes(key.replace(/^_/g, ''))\n    ) {\n      transformedProps[key.replace(/^_/g, '')] = props[key];\n    } else {\n      transformedProps[key] = props[key];\n    }\n  });\n  return transformedProps;\n}\n\nexport type DeclarationRelativeProps<\n  T extends ExtensionDeclaration\n> = T extends FieldExtensionDeclaration\n  ? FieldExtensionProps\n  : T extends FormSidebarExtensionDeclaration\n  ? FormSidebarExtensionProps\n  : ExtensionProps;\n\nexport function init<T extends ExtensionDeclaration>({\n  debug,\n  declaration,\n  onProps = () => undefined,\n  uid: givenUid,\n}: {\n  declaration: T;\n  onProps: (props: DeclarationRelativeProps<T>) => unknown;\n  debug?: boolean;\n  uid?: string;\n}) {\n  return new Promise<\n    | { status: 'ok'; props: DeclarationRelativeProps<T> }\n    | { status: 'validation' }\n  >((resolve, reject) => {\n    if (\n      typeof window === 'undefined' ||\n      typeof window.postMessage === 'undefined'\n    ) {\n      return reject({\n        error: 'unsupported_env',\n        message:\n          'Unsupported environment: Not in a browser supporting PostMessage',\n      });\n    }\n\n    const uid =\n      givenUid ||\n      (typeof URLSearchParams !== 'undefined' &&\n        new URLSearchParams(window.location.search).get('extensionUid'));\n\n    if (!uid) {\n      if (debug)\n        console.error(`[UIX] no uid found in init params or extension URL`);\n      return reject({\n        error: 'missing_uid',\n        message: 'Missing UID: no UID found in init params or extension URL',\n      });\n    }\n    if (debug) console.info(`[UIX:${uid}] initializing with uid ${uid}`);\n\n    zoid.create({\n      tag: uid,\n      url: window.location.href.toString(),\n      autoResize: {\n        width: false,\n        height: true,\n        element: 'html',\n      },\n      props: {\n        onConnected: {\n          type: 'function',\n        },\n      },\n    });\n    if (typeof window.xprops !== 'undefined') {\n      const { onConnected, onProps: initialOnProps } = window.xprops;\n      if (debug) {\n        console.info(`[UIX:${uid}] transmitting declaration`, declaration);\n      }\n      onConnected(uid, declaration).then((status) => {\n        if (status === true) {\n          const {\n            onProps: onParentProps,\n            onConnected: _nevermind,\n            resize,\n            ...extensionProps\n          } = window.xprops;\n\n          if (debug)\n            console.info(`[UIX:${uid}] initial shared props`, extensionProps);\n          onParentProps((p: Xprops) => {\n            const {\n              onProps: onParentProps,\n              onConnected,\n              ...newExtensionProps\n            } = p;\n\n            if (debug)\n              console.info(`[UIX:${uid}] new shared props`, newExtensionProps);\n            if ('isExpanded' in p && typeof p.isExpanded === 'boolean') {\n              p.isExpanded\n                ? resize({ height: 'full', width: '100%' })\n                : resize({ height: 'auto', width: '100%' });\n            }\n            onProps(handleProps(newExtensionProps));\n          });\n\n          if (debug) console.info(`[UIX:${uid}] initialized`);\n          onProps(handleProps(extensionProps));\n          resolve({ status: 'ok', props: handleProps(extensionProps) });\n        } else {\n          if (debug)\n            console.info(`[UIX:${uid}] sdk renderer returned status:`, status);\n          resolve({ status: 'validation' });\n        }\n      });\n    } else {\n      if (debug) console.error(`[UIX] no shared props from host found`);\n      reject({\n        error: 'failed_communication',\n        message:\n          'No communication established with host, please check your URL',\n      });\n    }\n  });\n}\n\nexport default { init };\n"],"names":["reservedExtensionProps","ExtensionPermission","INPUT","FORM","API","ExtensionType","formSidebar","field","ConfigType","string","number","ToastVariantColor","success","error","warning","info","primary","dark","publish","ToastPosition","UserKind","MEMBER","PAT","PUBLIC","WEBHOOK","FieldExtensionType","STRING","RICHTEXT","INT","FLOAT","BOOLEAN","JSON","DATETIME","DATE","LOCATION","COLOR","ENUMERATION","RELATION","ASSET","UNION","FieldExtensionFeature","FieldRenderer","ListRenderer","TableRenderer","handleProps","props","transformedProps","Object","keys","forEach","key","includes","startsWith","replace","init","debug","declaration","onProps","undefined","givenUid","uid","Promise","resolve","reject","window","postMessage","message","URLSearchParams","location","search","get","console","zoid","create","tag","url","href","toString","autoResize","width","height","element","onConnected","type","xprops","then","status","onParentProps","_nevermind","resize","extensionProps","p","newExtensionProps","isExpanded"],"mappings":"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"}